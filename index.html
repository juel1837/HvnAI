<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HvnChat - AI Website Builder</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body {
            height: 100dvh;
            min-height: 100dvh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            background-color: #0f172a;
        }
        .sidebar-transition { transition: transform 0.3s ease-in-out; }
        @media (max-width: 1024px) {
            .sidebar-mobile {
                position: absolute;
                z-index: 40;
                height: 100%;
                transform: translateX(-100%);
            }
            .sidebar-mobile.open { transform: translateX(0); }
        }
        /* Error Message Styling for better visibility */
        #errorNotice {
            display: none;
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 100;
            background: #ef4444;
            color: white;
            padding: 1rem;
            border-radius: 0.75rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.5);
            max-width: 320px;
            border: 2px solid #b91c1c;
            font-weight: 600;
        }
    </style>
</head>
<body class="text-gray-100">

    <div id="errorNotice">
        <div class="flex items-start gap-3">
            <i data-lucide="alert-circle" class="shrink-0"></i>
            <div>
                <p class="text-sm font-bold uppercase tracking-tight">System Error</p>
                <p id="errorText" class="text-sm font-medium mt-1 opacity-90"></p>
            </div>
            <button onclick="hideError()" class="hover:bg-black/20 rounded p-0.5"><i data-lucide="x" class="w-4 h-4"></i></button>
        </div>
    </div>

    <div class="flex flex-1 overflow-hidden relative">
        
        <aside id="sidebar" class="sidebar-mobile lg:relative w-72 bg-gray-900 border-r border-gray-800 flex flex-col shrink-0 sidebar-transition">
            <div class="p-4 flex items-center justify-between">
                <span class="font-bold text-xl text-blue-500 tracking-tight">HvnChat</span>
                <button onclick="toggleSidebar()" class="lg:hidden text-gray-400 hover:text-white">
                    <i data-lucide="x"></i>
                </button>
            </div>
            
            <div class="px-4 mb-4">
                <button onclick="createNewProject()" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-4 rounded-xl flex items-center justify-center gap-2 transition-all active:scale-95 shadow-lg">
                    <i data-lucide="plus" class="w-5 h-5"></i> New Project
                </button>
            </div>
            
            <div id="projectList" class="flex-1 overflow-y-auto px-4 space-y-2 pb-4">
                </div>

            <div class="p-4 border-t border-gray-800 bg-gray-900/50">
                <button onclick="toggleSettings()" class="flex items-center gap-3 text-gray-400 hover:text-white hover:bg-gray-800 p-3 rounded-xl transition-all w-full">
                    <i data-lucide="settings" class="w-5 h-5"></i> Settings
                </button>
            </div>
        </aside>

        <main class="flex-1 flex flex-col min-w-0 bg-gray-950">
            <header class="h-16 border-b border-gray-800 flex items-center justify-between px-4 bg-gray-900/30">
                <div class="flex items-center gap-3">
                    <button onclick="toggleSidebar()" class="p-2 hover:bg-gray-800 rounded-lg lg:hidden transition">
                        <i data-lucide="menu" class="w-6 h-6"></i>
                    </button>
                    <div class="hidden sm:flex gap-1.5">
                        <div class="w-3 h-3 rounded-full bg-red-500"></div>
                        <div class="w-3 h-3 rounded-full bg-yellow-500"></div>
                        <div class="w-3 h-3 rounded-full bg-green-500"></div>
                    </div>
                </div>

                <div class="flex items-center gap-1 bg-black p-1 rounded-xl border border-gray-800">
                    <button onclick="setView('preview')" id="btnPreview" class="px-5 py-1.5 rounded-lg bg-blue-600 text-sm font-bold transition-all">Preview</button>
                    <button onclick="setView('code')" id="btnCode" class="px-5 py-1.5 rounded-lg hover:bg-gray-800 text-sm font-bold transition-all text-gray-400">Code</button>
                </div>

                <button onclick="downloadCode()" class="p-2 hover:bg-gray-800 rounded-full transition-all text-blue-500">
                    <i data-lucide="download" class="w-5 h-5"></i>
                </button>
            </header>

            <div class="flex-1 relative bg-white overflow-hidden">
                <iframe id="previewFrame" class="w-full h-full"></iframe>
                <div id="codeEditor" class="absolute inset-0 bg-[#0d1117] hidden">
                    <textarea id="rawCode" class="w-full h-full p-6 font-mono text-sm bg-transparent text-blue-300 outline-none resize-none" readonly></textarea>
                </div>
                
                <div id="loader" class="absolute inset-0 bg-black/80 backdrop-blur-sm flex flex-col items-center justify-center hidden z-20">
                    <div class="animate-spin rounded-full h-12 w-12 border-4 border-blue-500 border-t-transparent mb-4"></div>
                    <p class="text-blue-500 font-bold animate-pulse uppercase tracking-widest text-xs">AI is building...</p>
                </div>
            </div>

            <footer class="p-4 border-t border-gray-800 bg-gray-900 shrink-0">
                <div class="max-w-4xl mx-auto flex gap-3">
                    <textarea id="userInput" rows="1" 
                        placeholder="Describe the website you want to build..." 
                        class="flex-1 bg-gray-800 border border-gray-700 rounded-xl py-3 px-4 focus:outline-none focus:ring-2 focus:ring-blue-600/50 focus:border-blue-500 resize-none text-white transition-all overflow-hidden"
                        oninput="this.style.height = '';this.style.height = this.scrollHeight + 'px'"></textarea>
                    
                    <button id="sendBtn" onclick="generateWebsite()" class="bg-blue-600 hover:bg-blue-700 active:scale-95 p-3 rounded-xl transition-all self-end shadow-xl">
                        <i data-lucide="zap" class="w-6 h-6 text-white"></i>
                    </button>
                </div>
            </footer>
        </main>
    </div>

    <div id="settingsModal" class="fixed inset-0 bg-black/90 hidden z-50 flex items-center justify-center p-4 backdrop-blur-sm">
        <div class="bg-gray-900 w-full max-w-md rounded-2xl border border-gray-800 shadow-2xl">
            <div class="p-6">
                <h2 class="text-xl font-bold mb-6 flex items-center gap-2">
                    <i data-lucide="sliders-horizontal" class="text-blue-500"></i> Settings
                </h2>
                <div class="space-y-6">
                    <div>
                        <label class="block text-xs font-bold text-gray-500 uppercase mb-2">AI Model ID</label>
                        <input id="modelId" type="text" placeholder="e.g. google/gemini-2.0-flash-exp:free" class="w-full bg-black border border-gray-800 rounded-lg p-3 text-sm focus:border-blue-600 outline-none transition-all">
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-gray-500 uppercase mb-2">OpenRouter API Key</label>
                        <input id="apiKey" type="password" placeholder="Enter your sk-or-... key" class="w-full bg-black border border-gray-800 rounded-lg p-3 text-sm focus:border-blue-600 outline-none transition-all">
                    </div>
                </div>
            </div>
            <div class="bg-gray-800/50 p-4 flex justify-end">
                <button onclick="toggleSettings()" class="bg-blue-600 hover:bg-blue-700 px-8 py-2.5 rounded-xl font-bold transition-all shadow-lg">Save Config</button>
            </div>
        </div>
    </div>

    <script>
        const API_URL = "https://openrouter.ai/api/v1/chat/completions";
        const SYSTEM_PROMPT = "You are an expert web developer. Output ONLY raw, valid, single-file HTML code using Tailwind CSS CDN. Do NOT use any markdown backticks. Start with <!DOCTYPE html>.";
        
        let projects = JSON.parse(localStorage.getItem('hvn_projects') || '[]');
        let currentCode = "";

        lucide.createIcons();

        window.onload = () => {
            document.getElementById('apiKey').value = localStorage.getItem('apiKey') || "";
            document.getElementById('modelId').value = localStorage.getItem('modelId') || "deepseek/deepseek-r1:free";
            renderProjects();
        };

        function showError(msg) {
            const notice = document.getElementById('errorNotice');
            const text = document.getElementById('errorText');
            text.innerText = msg;
            notice.style.display = 'block';
            setTimeout(hideError, 8000); // Auto hide after 8s
        }

        function hideError() {
            document.getElementById('errorNotice').style.display = 'none';
        }

        function toggleSidebar() { document.getElementById('sidebar').classList.toggle('open'); }

        function toggleSettings() {
            const modal = document.getElementById('settingsModal');
            if (!modal.classList.contains('hidden')) {
                localStorage.setItem('apiKey', document.getElementById('apiKey').value);
                localStorage.setItem('modelId', document.getElementById('modelId').value);
            }
            modal.classList.toggle('hidden');
        }

        function setView(view) {
            const preview = document.getElementById('previewFrame');
            const editor = document.getElementById('codeEditor');
            const btnP = document.getElementById('btnPreview');
            const btnC = document.getElementById('btnCode');

            if (view === 'preview') {
                preview.classList.remove('hidden'); editor.classList.add('hidden');
                btnP.className = "px-5 py-1.5 rounded-lg bg-blue-600 text-sm font-bold transition-all";
                btnC.className = "px-5 py-1.5 rounded-lg hover:bg-gray-800 text-sm font-bold transition-all text-gray-400";
            } else {
                preview.classList.add('hidden'); editor.classList.remove('hidden');
                btnC.className = "px-5 py-1.5 rounded-lg bg-blue-600 text-sm font-bold transition-all";
                btnP.className = "px-5 py-1.5 rounded-lg hover:bg-gray-800 text-sm font-bold transition-all text-gray-400";
            }
        }

        async function generateWebsite() {
            const prompt = document.getElementById('userInput').value;
            const apiKey = document.getElementById('apiKey').value;
            const model = document.getElementById('modelId').value;

            if (!navigator.onLine) { showError("No internet connection detected."); return; }
            if (!apiKey) { showError("API Key is missing! Go to settings."); toggleSettings(); return; }
            if (!prompt) return;

            hideError();
            showLoader(true);

            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${apiKey}`,
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        model: model,
                        messages: [{ role: "system", content: SYSTEM_PROMPT }, { role: "user", content: prompt }]
                    })
                });

                const rawResponse = await response.text();
                
                if (!response.ok) {
                    let errorDetails = rawResponse;
                    try {
                        const parsedError = JSON.parse(rawResponse);
                        errorDetails = parsedError.error?.message || rawResponse;
                    } catch(e) {}
                    showError("API Error: " + errorDetails);
                    showLoader(false);
                    return;
                }

                const data = JSON.parse(rawResponse);
                let content = data.choices[0].message.content;
                currentCode = content.replace(/```html|```/g, "").trim();
                
                updateDisplay();
                saveProject(prompt.substring(0, 30), currentCode);
                document.getElementById('userInput').value = "";
                document.getElementById('userInput').style.height = 'auto';

            } catch (error) {
                showError("Request Failed: " + error.message);
            } finally {
                showLoader(false);
                if (window.innerWidth < 1024) toggleSidebar();
            }
        }

        function updateDisplay() {
            const iframe = document.getElementById('previewFrame');
            document.getElementById('rawCode').value = currentCode;
            const blob = new Blob([currentCode], { type: 'text/html' });
            iframe.src = URL.createObjectURL(blob);
        }

        function saveProject(name, code) {
            const project = { id: Date.now(), name, code };
            projects.unshift(project);
            localStorage.setItem('hvn_projects', JSON.stringify(projects));
            renderProjects();
        }

        function deleteProject(id, event) {
            event.stopPropagation();
            if (confirm("Permanently delete this project?")) {
                projects = projects.filter(p => p.id !== id);
                localStorage.setItem('hvn_projects', JSON.stringify(projects));
                renderProjects();
            }
        }

        function renderProjects() {
            const list = document.getElementById('projectList');
            list.innerHTML = projects.map(p => `
                <div onclick="loadProject(${p.id})" class="group flex items-center justify-between p-3.5 text-sm bg-gray-800/40 hover:bg-gray-800 rounded-xl cursor-pointer transition-all border border-transparent hover:border-gray-700">
                    <span class="truncate pr-2 text-gray-300 group-hover:text-white font-medium">${p.name}</span>
                    <button onclick="deleteProject(${p.id}, event)" class="opacity-0 group-hover:opacity-100 p-1 hover:text-red-500 transition-all">
                        <i data-lucide="trash-2" class="w-4 h-4"></i>
                    </button>
                </div>
            `).join('');
            lucide.createIcons();
        }

        function loadProject(id) {
            const p = projects.find(item => item.id === id);
            if (p) {
                currentCode = p.code; updateDisplay(); setView('preview');
                if (window.innerWidth < 1024) toggleSidebar();
            }
        }

        function createNewProject() {
            if (currentCode && !confirm("Current progress will be lost. Start new?")) return;
            currentCode = ""; updateDisplay();
            document.getElementById('userInput').value = "";
            if (window.innerWidth < 1024) toggleSidebar();
        }

        function downloadCode() {
            if (!currentCode) return showError("No code to download yet.");
            const a = document.createElement('a');
            a.href = URL.createObjectURL(new Blob([currentCode], { type: 'text/html' }));
            a.download = 'hvnchat-export.html';
            a.click();
        }

        function showLoader(show) {
            document.getElementById('loader').classList.toggle('hidden', !show);
            document.getElementById('sendBtn').disabled = show;
        }
    </script>
</body>
                        </html>
                        
